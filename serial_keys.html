<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シリアルキー一覧 - atsumeru</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.8; margin: 0; color: #333; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        section { padding: 60px 20px; }
        h1, h2 { text-align: center; }
        h1 { font-size: 2.5em; }
        h2 { font-size: 2em; margin-bottom: 40px;}
        .back-link { display: block; text-align: center; margin-bottom: 40px; }

        /* アコーディオンUIのスタイル */
        .group-title { font-size: 1.6em; margin-top: 20px; margin-bottom: 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; position: relative; background-color: #343a40; color: white; }
        .group-title:first-of-type { margin-top: 0; }
        .group-title::after { content: '▼'; position: absolute; right: 20px; transition: transform 0.3s; }
        .group-title.active::after { transform: rotate(180deg); }
        .year-list-container { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.4s ease-out; }
        .group-title.active + .year-list-container { grid-template-rows: 1fr; }
        .year-list-inner { overflow: hidden; padding: 10px 0 10px 20px; }
        
        .year-title { font-size: 1.3em; margin-top: 10px; margin-bottom: 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; position: relative; background-color: #f8f9fa; }
        .year-title::after { content: '▼'; font-size: 0.8em; position: absolute; right: 20px; transition: transform 0.3s; }
        .year-title.active::after { transform: rotate(180deg); }
        .key-list-container { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.4s ease-out; }
        .year-title.active + .key-list-container { grid-template-rows: 1fr; }
        .key-list-inner { overflow: hidden; padding: 10px 0 10px 20px; }

        .accordion-item { border-top: 1px solid #eee; }
        .accordion-item:first-child { border-top: none; }
        .accordion-title { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; font-weight: bold; background: #fff; }
        .accordion-title::after { content: '›'; font-size: 1.5em; transition: transform 0.3s; }
        .accordion-item.active .accordion-title::after { transform: rotate(90deg); }
        .accordion-content { display: grid; grid-template-rows: 0fr; transition: grid-template-rows 0.3s ease-out; }
        .accordion-item.active .accordion-content { grid-template-rows: 1fr; }
        .accordion-content-inner { overflow: hidden; padding: 20px; background-color: #f9f9f9; }
        
        .serial-key-code { background-color: #e9ecef; padding: 5px 10px; border-radius: 4px; font-family: monospace; }
        .tag { display: inline-block; background-color: #6c757d; color: white; padding: 2px 8px; font-size: 0.8em; border-radius: 10px; margin-right: 5px; }

        footer { text-align: center; padding: 30px; background-color: #343a40; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <h1>atsumeru</h1>
        <h2>シリアルキー一覧</h2>
        <p style="text-align: center;">随時追加しています。訂正などございましたら<a href="index.html#feedback-form">ご意見・ご要望フォーム</a>よりお知らせください。</p>
        <a href="index.html" class="back-link">← 公式サイトトップに戻る</a>
        
        <section id="serial-keys">
            <div id="serial-key-groups">
                </div>
        </section>
    </div>

    <footer>
        <p>&copy; 2025 Asahi Mizutani. All Rights Reserved.</p>
    </footer>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // `serial_keys.json`のパスを適切に設定してください
        fetch('serial_keys.json') 
            .then(response => response.json())
            .then(data => {
                const rootContainer = document.getElementById('serial-key-groups');
                if (!rootContainer) return;

                const allSeries = data.series;
                const allKeys = data.keys;

                const nestedData = {};
                for (const serialKey in allKeys) {
                    const keyInfo = allKeys[serialKey];
                    const group = keyInfo.groupName || 'その他';
                    const year = keyInfo.year || '未分類';
                    if (!nestedData[group]) nestedData[group] = {};
                    if (!nestedData[group][year]) nestedData[group][year] = [];
                    keyInfo.id = serialKey;
                    nestedData[group][year].push(keyInfo);
                }

                let htmlContent = '';
                for (const groupName in nestedData) {
                    htmlContent += `<div class="group-container"><h3 class="group-title">${groupName}</h3><div class="year-list-container"><div class="year-list-inner">`;
                    for (const year in nestedData[groupName]) {
                        htmlContent += `<div class="year-container"><h4 class="year-title">${year}年</h4><div class="key-list-container"><div class="key-list-inner">`;
                        nestedData[groupName][year].forEach(keyInfo => {
                            let detailsHtml = '';
                            if (keyInfo.series_ids.length === 1) {
                                const seriesId = keyInfo.series_ids[0];
                                const seriesData = allSeries[seriesId];
                                if (seriesData) {
                                    const tagsHtml = seriesData.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ');
                                    detailsHtml = `
                                        <p><strong>種類:</strong> ${seriesData.kinds.join(', ')}</p>
                                        <p><strong>対象メンバー:</strong> ${seriesData.members.join(', ')}</p>
                                        <p><strong>タグ:</strong> ${tagsHtml || 'なし'}</p>
                                    `;
                                }
                            } else {
                                let seriesListHtml = '<ul>';
                                keyInfo.series_ids.forEach(seriesId => {
                                    const seriesData = allSeries[seriesId];
                                    if (seriesData) {
                                        seriesListHtml += `<li><strong>${seriesData.seriesName}</strong></li>`;
                                    }
                                });
                                seriesListHtml += '</ul>';
                                detailsHtml = `<p><strong>このキーで入手できるシリーズ:</strong></p>${seriesListHtml}`;
                            }

                            htmlContent += `
                                <div class="accordion-item">
                                    <div class="accordion-title">${keyInfo.title}</div>
                                    <div class="accordion-content">
                                        <div class="accordion-content-inner">
                                            ${detailsHtml}
                                            <hr>
                                            <p><strong>シリアルキー:</strong> <code class="serial-key-code">${keyInfo.id}</code></p>
                                        </div>
                                    </div>
                                </div>`;
                        });
                        htmlContent += `</div></div></div>`;
                    }
                    htmlContent += `</div></div></div>`;
                }
                rootContainer.innerHTML = htmlContent;
                setupEventListeners();
            })
            .catch(error => console.error('シリアルキーの読み込みに失敗しました:', error));
    });

    function setupEventListeners() {
        document.querySelectorAll('.group-title, .year-title').forEach(title => {
            title.addEventListener('click', (e) => {
                e.stopPropagation();
                e.currentTarget.classList.toggle('active');
            });
        });
        document.querySelectorAll('.accordion-title').forEach(title => {
            title.addEventListener('click', (e) => {
                e.stopPropagation();
                e.currentTarget.parentElement.classList.toggle('active');
            });
        });
    }
    </script>
</body>
</html>
